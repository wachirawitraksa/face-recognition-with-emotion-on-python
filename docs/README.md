# Face Recognition System with Emotion Detection
‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏∏‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö Real-time ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (Windows / Python 3.11)

> Author: Wachirawit Raksa ¬∑ Modified: 2025  
> Stack: OpenCV + MediaPipe + face_recognition (Dlib) + DeepFace (TensorFlow)

---

## ‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå
- ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏î‡πâ‡∏ß‡∏¢ **MediaPipe Face Detection**
- ‡∏£‡∏∞‡∏ö‡∏∏ ‚Äú‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‚Äù ‡∏î‡πâ‡∏ß‡∏¢ **face_recognition (Dlib encodings)**
- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå (emotion) ‡∏î‡πâ‡∏ß‡∏¢ **DeepFace**
- ‡πÅ‡∏Ñ‡∏ä/‡∏ó‡∏≥ smoothing ‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏•‡∏ô‡∏¥‡πà‡∏á‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÇ‡∏´‡∏•‡∏î‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ü‡∏•‡πå **PKL** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏π‡∏ó‡πÄ‡∏£‡πá‡∏ß
- ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå FPS / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / tolerance ‡πÑ‡∏î‡πâ

---

## üß± ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
```text
face-recognition-with-emotion-on-python/
‚îú‚îÄ dataset/                  # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô
‚îÇ  ‚îú‚îÄ person1/ img001.jpg ...
‚îÇ  ‚îî‚îÄ person2/   img010.jpg ...
‚îú‚îÄ docs/                  # ‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏ô
‚îÇ  ‚îú‚îÄ flowchart.png
‚îÇ  ‚îî‚îÄ README.md
‚îú‚îÄ src/
‚îÇ  ‚îî‚îÄ haarcascade_frontalface_default.xml       # Object Detection Algorithm
‚îú‚îÄ trained/
‚îÇ  ‚îî‚îÄ face_dataset.pkl       # ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à)
‚îú‚îÄ main.py                   # ‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡∏´‡∏•‡∏±‡∏Å
‚îî‚îÄ requirements.txt          # ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡πÑ‡∏ß‡πâ
```

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á `dataset/` (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
```text
dataset/
‚îú‚îÄ person1/
‚îÇ  ‚îú‚îÄ 01.jpg
‚îÇ  ‚îú‚îÄ 02.jpg
‚îÇ  ‚îî‚îÄ 03.jpg
‚îî‚îÄ person2/
   ‚îú‚îÄ a.jpg
   ‚îî‚îÄ b.png
```
- ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö `.jpg/.jpeg/.png`  
- ‡∏Ñ‡∏ß‡∏£‡∏°‡∏µ 3‚Äì10 ‡∏£‡∏π‡∏õ‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏∏‡∏°/‡∏´‡∏•‡∏≤‡∏¢‡∏™‡∏†‡∏≤‡∏û‡πÅ‡∏™‡∏á

---

## üñ•Ô∏è ‡∏Ç‡πâ‡∏≠‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏∞‡∏ö‡∏ö
- Windows 10/11  
- **Python 3.11.9**  
- ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏Ñ‡∏°  
- (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ) GPU ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö TensorFlow  

---

## üì¶ ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á
```powershell
# ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
cd C:\Users\<username>\OneDrive\Documents\face-recog-emotion

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô venv
python -m venv .venv
.\.venv\Scripts\Activate.ps1

# ‡∏≠‡∏±‡∏õ pip
python -m pip install --upgrade pip

# ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies
pip install -r requirements.txt

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ
pip check
```

---

## üöÄ ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏π‡∏õ‡πÉ‡∏ô `dataset/`  
2. ‡∏£‡∏±‡∏ô:
   ```powershell
   python main.py
   ```
3. ‡∏Å‡∏î `q` ‡∏´‡∏£‡∏∑‡∏≠ `ESC` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å  

---

## ‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏•‡∏±‡∏Å (‡πÉ‡∏ô `FaceRecognitionSystem.__init__`)
- `FACE_RECOGNITION_TOLERANCE` (default 0.55)  
- `MIN_FACE_SIZE` ‚Äì ‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥  
- `EMOTION_ANALYSIS_INTERVAL` ‚Äì ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏≤‡∏£‡∏°‡∏ì‡πå  
- `PROCESSING_SCALE` ‚Äì ‡∏¢‡πà‡∏≠‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö (‡∏•‡∏î‡∏•‡∏á = ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô)  
- `TARGET_FPS` ‚Äì ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ FPS  
- `EMOTION_SMOOTHING_FRAMES` ‚Äì ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ü‡∏£‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö smoothing  

---

## üß™ ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û
- ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏∏‡∏°/‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏™‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô  
- ‡∏•‡∏î `PROCESSING_SCALE` (‡πÄ‡∏ä‡πà‡∏ô 0.5) ‡∏´‡∏≤‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ä‡πâ‡∏≤  
- ‡πÄ‡∏õ‡∏¥‡∏î MJPG ‡πÉ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á ‚Üí FPS ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô  

---

## üßØ Troubleshooting
### MediaPipe / Protobuf Error
```
RuntimeError: Failed to parse: node {...}
```
‡πÅ‡∏Å‡πâ‡πÇ‡∏î‡∏¢:
```powershell
pip uninstall -y protobuf numpy
pip install protobuf==4.25.8 numpy==1.26.4
pip install mediapipe==0.10.21
pip check
```

### OpenCV ‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô numpy
```powershell
pip install opencv-python==4.11.0.86 opencv-contrib-python==4.11.0.86
```

---

## üîè Privacy
- ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á (on-device)  
- PKL ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ encodings + ‡∏ä‡∏∑‡πà‡∏≠ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏π‡∏õ‡∏à‡∏£‡∏¥‡∏á  

---

## üìú Author
Wachirawit Raksa
(27/07/2025)

---

## üôè Credits
- MediaPipe by Google Research  
- dlib / face_recognition by Davis E. King  
- DeepFace by Serengil & contributors  
- OpenCV community  
